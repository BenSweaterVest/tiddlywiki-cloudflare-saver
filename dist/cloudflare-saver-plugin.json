{
  "tiddlers": {
    "$:/plugins/BenSweaterVest/cloudflare-saver/plugin.info": {
      "title": "$:/plugins/BenSweaterVest/cloudflare-saver/plugin.info",
      "type": "application/json",
      "text": "{\n  \"title\": \"$:/plugins/BenSweaterVest/cloudflare-saver\",\n  \"description\": \"Save TiddlyWiki to GitHub via Cloudflare Functions with password authentication\",\n  \"author\": \"BenSweaterVest\",\n  \"version\": \"1.1.0\",\n  \"core-version\": \">=5.1.22\",\n  \"source\": \"https://github.com/BenSweaterVest/tiddlywiki-cloudflare-saver\",\n  \"plugin-type\": \"plugin\",\n  \"list\": \"readme\"\n}"
    },
    "$:/plugins/BenSweaterVest/cloudflare-saver/saver.js": {
      "title": "$:/plugins/BenSweaterVest/cloudflare-saver/saver.js",
      "type": "application/javascript",
      "module-type": "saver",
      "text": "/*\\\ntitle: $:/plugins/BenSweaterVest/cloudflare-saver/saver.js\ntype: application/javascript\nmodule-type: saver\n\nCloudflare Functions saver for TiddlyWiki - Additional Saver Option\n\nThis saver allows TiddlyWiki to save to GitHub via a Cloudflare Function.\nIt works as an additional save option alongside other savers.\n\nFeatures:\n- Password authentication\n- Auto-retry with exponential backoff\n- Session password memory\n- Visual notifications\n- Comprehensive error handling\n\n\\*/\n(function(){\n\n  'use strict';\n\n  /**\n * CloudflareSaver constructor\n * @param {Object} wiki - TiddlyWiki wiki object\n */\n  const CloudflareSaver = function(wiki) {\n    this.wiki = wiki;\n    this.sessionPassword = null; // Store password for session if enabled\n\n    // Listen for clear password events\n    const self = this;\n    $tw.rootWidget.addEventListener('cloudflare-clear-password', () => {\n      self.sessionPassword = null;\n    });\n  };\n\n  CloudflareSaver.prototype.save = function(text, method, callback, options) {\n    const self = this;\n    options = options || {};\n\n    // Check if this saver is enabled\n    const enabled = self.wiki.getTiddlerText('$:/config/cloudflare-saver/enabled', 'no') === 'yes';\n    if(!enabled) {\n      return false; // Let other savers handle it\n    }\n\n    // Validate configuration before claiming to handle the save\n    const endpoint = self.wiki.getTiddlerText('$:/config/cloudflare-saver/endpoint', '');\n    if(!endpoint || endpoint.trim() === '') {\n      return false; // Let other savers handle it if not configured\n    }\n\n    // We can handle save and autosave methods\n    if(method !== 'save' && method !== 'autosave') {\n      return false;\n    }\n\n    const config = {\n      endpoint,\n      timeout: Math.max(5, parseInt(self.wiki.getTiddlerText('$:/config/cloudflare-saver/timeout', '30')) || 30) * 1000,\n      notifications: self.wiki.getTiddlerText('$:/config/cloudflare-saver/notifications', 'yes') === 'yes',\n      autoRetry: self.wiki.getTiddlerText('$:/config/cloudflare-saver/auto-retry', 'yes') === 'yes',\n      rememberPassword: self.wiki.getTiddlerText('$:/config/cloudflare-saver/remember-password', 'no') === 'yes',\n      debug: self.wiki.getTiddlerText('$:/config/cloudflare-saver/debug', 'no') === 'yes'\n    };\n\n    if(config.debug) {\n      console.log('[CloudflareSaver] Starting save process');\n    }\n\n    let password = null;\n    if(config.rememberPassword && self.sessionPassword) {\n      password = self.sessionPassword;\n    } else {\n      password = prompt('Enter Cloudflare save password:');\n      if (!password) {\n        callback('Cloudflare save cancelled by user');\n        return false;\n      }\n      if(config.rememberPassword) {\n        self.sessionPassword = password;\n      }\n    }\n\n    if(config.notifications && typeof $tw !== 'undefined' && $tw.notifier) {\n      $tw.notifier.display('$:/plugins/BenSweaterVest/cloudflare-saver/notifications/saving');\n    }\n\n    self._performSave(text, password, callback, config, 0);\n    return true;\n  };\n\n  CloudflareSaver.prototype._performSave = async function(text, password, callback, config, retryCount) {\n    const self = this;\n    const controller = new AbortController();\n    const timeoutId = setTimeout(() => controller.abort(), config.timeout);\n\n    try {\n      const payload = {\n        content: text,\n        password,\n        timestamp: new Date().toISOString(),\n        retryCount\n      };\n\n      const response = await fetch(config.endpoint, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json'\n        },\n        body: JSON.stringify(payload),\n        signal: controller.signal\n      });\n\n      clearTimeout(timeoutId);\n\n      if(response.ok) {\n        if(config.debug) {\n          console.log('[CloudflareSaver] Save successful');\n        }\n\n        // Update statistics\n        self._incrementStat('successful-saves');\n        self._updateLastSave('success');\n\n        callback(null);\n        if(config.notifications && typeof $tw !== 'undefined' && $tw.notifier) {\n          $tw.notifier.display('$:/plugins/BenSweaterVest/cloudflare-saver/notifications/success');\n        }\n      } else {\n        const responseText = await response.text();\n        self._handleSaveError(response.status, response.statusText, responseText, password, text, callback, config, retryCount);\n      }\n    } catch(error) {\n      clearTimeout(timeoutId);\n\n      // Handle abort/timeout separately\n      if (error.name === 'AbortError') {\n        self._handleSaveError(0, 'Request timeout', '', password, text, callback, config, retryCount);\n      } else {\n        self._handleSaveError(0, 'Network error', error.message, password, text, callback, config, retryCount);\n      }\n    }\n  };\n\n  CloudflareSaver.prototype._handleSaveError = function(status, statusText, responseText, password, text, callback, config, retryCount) {\n    const self = this;\n    const maxRetries = config.autoRetry ? 3 : 0;\n\n    let errorMsg = 'Cloudflare save failed';\n    if(status) {\n      errorMsg += `: HTTP ${  status}`;\n      if(statusText) {\n        errorMsg += ` ${  statusText}`;\n      }\n    }\n\n    // Parse response for detailed error information\n    if(responseText) {\n      try {\n        const response = JSON.parse(responseText);\n        if(response.error) {\n          errorMsg += ` - ${  response.error}`;\n        }\n        // Add rate limit information if available\n        if(response.resetIn) {\n          errorMsg += ` (retry in ${  response.resetIn  } seconds)`;\n        }\n      } catch(e) {\n        if(responseText.length < 200) {\n          errorMsg += ` - ${  responseText}`;\n        }\n      }\n    }\n\n    // Handle specific HTTP status codes\n    if(status === 401) {\n      self.sessionPassword = null;\n      errorMsg = 'Cloudflare authentication failed. Please check your password.';\n    } else if(status === 429) {\n      errorMsg = 'Rate limit exceeded. Please wait a minute before trying again.';\n    } else if(status === 413) {\n      errorMsg = 'Content too large. Your TiddlyWiki exceeds the maximum allowed size.';\n    } else if(status === 409) {\n      errorMsg = 'Conflict detected. Another save may be in progress.';\n    }\n\n    if(config.debug) {\n      console.error('[CloudflareSaver] Error:', errorMsg, {\n        status,\n        retryCount,\n        willRetry: retryCount < maxRetries && status !== 401\n      });\n    }\n\n    // Retry logic (don't retry auth failures or rate limits)\n    if(retryCount < maxRetries && status !== 401 && status !== 429) {\n      const retryDelay = Math.min(1000 * Math.pow(2, retryCount), 10000);\n      if(config.debug) {\n        console.log(`[CloudflareSaver] Retrying in ${  retryDelay / 1000  } seconds...`);\n      }\n      setTimeout(() => {\n        self._performSave(text, password, callback, config, retryCount + 1);\n      }, retryDelay);\n    } else {\n      // Update statistics for final failure\n      self._incrementStat('failed-saves');\n      self._updateLastSave('failure', errorMsg);\n\n      callback(errorMsg);\n      if(config.notifications && typeof $tw !== 'undefined' && $tw.notifier) {\n        $tw.notifier.display('$:/plugins/BenSweaterVest/cloudflare-saver/notifications/failure');\n      }\n    }\n  };\n\n  CloudflareSaver.prototype._incrementStat = function(statName) {\n    const tiddlerTitle = `$:/config/cloudflare-saver/stats/${statName}`;\n    const currentValue = parseInt(this.wiki.getTiddlerText(tiddlerTitle, '0')) || 0;\n    this.wiki.addTiddler(new $tw.Tiddler({\n      title: tiddlerTitle,\n      text: String(currentValue + 1)\n    }));\n  };\n\n  CloudflareSaver.prototype._updateLastSave = function(status, error) {\n    const timestamp = new Date().toISOString();\n    this.wiki.addTiddler(new $tw.Tiddler({\n      title: '$:/config/cloudflare-saver/stats/last-save-status',\n      text: status,\n      'last-save-time': timestamp,\n      'last-save-error': error || ''\n    }));\n  };\n\n  CloudflareSaver.prototype.info = {\n    name: 'cloudflare',\n    priority: 2000, // High priority - when enabled, prefer this over download saver\n    capabilities: ['save', 'autosave']\n  };\n\n  // Export saver info at module level\n  exports.info = {\n    name: 'cloudflare',\n    priority: 2000,\n    capabilities: ['save', 'autosave']\n  };\n\n  // Export module-level functions as required by TiddlyWiki\n  exports.canSave = function(wiki) {\n    // Use $tw.wiki global instead of wiki parameter during initialization\n    const enabled = $tw.wiki.getTiddlerText('$:/config/cloudflare-saver/enabled', 'no') === 'yes';\n    const endpoint = $tw.wiki.getTiddlerText('$:/config/cloudflare-saver/endpoint', '');\n    // Only claim we can save if both enabled AND endpoint is configured\n    return enabled && endpoint && endpoint.trim() !== '';\n  };\n\n  exports.create = function(wiki) {\n    return new CloudflareSaver(wiki);\n  };\n\n})();\n"
    },
    "$:/plugins/BenSweaterVest/cloudflare-saver/startup.js": {
      "title": "$:/plugins/BenSweaterVest/cloudflare-saver/startup.js",
      "type": "application/javascript",
      "module-type": "startup",
      "text": "/*\\\ntitle: $:/plugins/BenSweaterVest/cloudflare-saver/startup.js\ntype: application/javascript\nmodule-type: startup\n\nStartup module for Cloudflare Saver plugin - Register as additional saver\n\\*/\n(function(){\n\n  'use strict';\n\n  exports.name = 'cloudflare-saver-startup';\n  exports.platforms = ['browser'];\n  exports.after = ['startup'];\n  exports.synchronous = true;\n\n  exports.startup = function() {\n    // Don't automatically set as default saver - let users choose\n\n    // Set up configuration defaults\n    const configDefaults = {\n      '$:/config/cloudflare-saver/endpoint': '',\n      '$:/config/cloudflare-saver/timeout': '30',\n      '$:/config/cloudflare-saver/notifications': 'yes',\n      '$:/config/cloudflare-saver/auto-retry': 'yes',\n      '$:/config/cloudflare-saver/remember-password': 'no',\n      '$:/config/cloudflare-saver/debug': 'no',\n      '$:/config/cloudflare-saver/enabled': 'no'\n    };\n\n    Object.keys(configDefaults).forEach((title) => {\n      if(!$tw.wiki.getTiddler(title)) {\n        $tw.wiki.addTiddler(new $tw.Tiddler({\n          title,\n          text: configDefaults[title]\n        }));\n      }\n    });\n\n    const enabled = $tw.wiki.getTiddlerText('$:/config/cloudflare-saver/enabled', 'no') === 'yes';\n    const debug = $tw.wiki.getTiddlerText('$:/config/cloudflare-saver/debug', 'no') === 'yes';\n\n    if (debug) {\n      console.log(`[CloudflareSaver] Plugin loaded successfully${  enabled ? ' and enabled' : ' (disabled)'}`);\n    }\n  };\n\n})();\n\n"
    },
    "$:/plugins/BenSweaterVest/cloudflare-saver/test-action.js": {
      "title": "$:/plugins/BenSweaterVest/cloudflare-saver/test-action.js",
      "type": "application/javascript",
      "module-type": "widget",
      "text": "/*\\\ntitle: $:/plugins/BenSweaterVest/cloudflare-saver/test-action.js\ntype: application/javascript\nmodule-type: widget\n\nAction widget to test Cloudflare save connection\n\n\\*/\n(function(){\n\n  'use strict';\n\n  const Widget = require('$:/core/modules/widgets/widget.js').widget;\n\n  const TestCloudflareAction = function(parseTreeNode,options) {\n    this.initialise(parseTreeNode,options);\n  };\n\n  TestCloudflareAction.prototype = new Widget();\n\n  TestCloudflareAction.prototype.render = function(_parent,_nextSibling) {\n    this.computeAttributes();\n    this.execute();\n  };\n\n  TestCloudflareAction.prototype.execute = function() {\n    // Nothing to execute\n  };\n\n  TestCloudflareAction.prototype.refresh = function(_changedTiddlers) {\n    return false;\n  };\n\n  TestCloudflareAction.prototype.invokeAction = function(_triggeringWidget,_event) {\n    const self = this;\n\n    // Get configuration\n    const endpoint = $tw.wiki.getTiddlerText('$:/config/cloudflare-saver/endpoint', '');\n    const enabled = $tw.wiki.getTiddlerText('$:/config/cloudflare-saver/enabled', 'no') === 'yes';\n\n    // Validate configuration\n    if (!enabled) {\n      self.showAlert('Cloudflare Saver is not enabled. Please enable it in the settings above.', 'error');\n      return true;\n    }\n\n    if (!endpoint || endpoint.trim() === '') {\n      self.showAlert('No Cloudflare Function endpoint configured. Please enter your endpoint URL above.', 'error');\n      return true;\n    }\n\n    // Get password\n    const password = prompt('Enter your Cloudflare save password to test the connection:');\n    if (!password) {\n      self.showAlert('Test cancelled - no password provided.', 'info');\n      return true;\n    }\n\n    // Show loading state\n    self.showNotification('$:/plugins/BenSweaterVest/cloudflare-saver/notifications/saving');\n\n    // Create test content\n    const testContent = $tw.wiki.renderTiddler('text/plain', '$:/core/save/all');\n\n    // Attempt to save\n    const timeout = Math.max(5, parseInt($tw.wiki.getTiddlerText('$:/config/cloudflare-saver/timeout', '30')) || 30) * 1000;\n    const controller = new AbortController();\n    const timeoutId = setTimeout(() => controller.abort(), timeout);\n\n    const payload = {\n      content: testContent,\n      password,\n      timestamp: new Date().toISOString(),\n      retryCount: 0\n    };\n\n    fetch(endpoint, {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json'\n      },\n      body: JSON.stringify(payload),\n      signal: controller.signal\n    })\n      .then((response) => {\n        clearTimeout(timeoutId);\n\n        if (response.ok) {\n          return response.json().then((data) => {\n            self.showNotification('$:/plugins/BenSweaterVest/cloudflare-saver/notifications/success');\n            self.showAlert(\n              `‚úÖ Test successful!\\n\\nConnection to Cloudflare Function verified.\\nCommit SHA: ${data.commit || 'N/A'}\\n\\nYour Cloudflare Saver is configured correctly.`,\n              'success'\n            );\n          });\n        } else {\n          return response.text().then((errorText) => {\n            let errorMsg = `HTTP ${response.status} ${response.statusText}`;\n            try {\n              const errorData = JSON.parse(errorText);\n              if (errorData.error) {\n                errorMsg = errorData.error;\n              }\n            } catch(e) {\n              // Use status text\n            }\n\n            self.showNotification('$:/plugins/BenSweaterVest/cloudflare-saver/notifications/failure');\n            self.showAlert(\n              `‚ùå Test failed!\\n\\nError: ${errorMsg}\\n\\nPlease check:\\n‚Ä¢ Your endpoint URL is correct\\n‚Ä¢ Your password matches SAVE_PASSWORD in Cloudflare\\n‚Ä¢ Environment variables are configured\\n‚Ä¢ The Cloudflare Function is deployed`,\n              'error'\n            );\n          });\n        }\n      })\n      .catch((error) => {\n        clearTimeout(timeoutId);\n\n        let errorMsg = 'Network error';\n        if (error.name === 'AbortError') {\n          errorMsg = 'Request timeout';\n        } else {\n          errorMsg = error.message;\n        }\n\n        self.showNotification('$:/plugins/BenSweaterVest/cloudflare-saver/notifications/failure');\n        self.showAlert(\n          `‚ùå Test failed!\\n\\nError: ${errorMsg}\\n\\nPlease check:\\n‚Ä¢ Your internet connection\\n‚Ä¢ The endpoint URL is accessible\\n‚Ä¢ CORS is configured to allow your origin\\n‚Ä¢ The Cloudflare Function is deployed`,\n          'error'\n        );\n      });\n\n    return true; // Prevent default action\n  };\n\n  TestCloudflareAction.prototype.showAlert = function(message, type) {\n    // Use TiddlyWiki's modal dialog\n    const tempTiddler = '$:/temp/cloudflare-test-result';\n\n    // Format message with proper TiddlyWiki markup\n    let icon = '';\n    let title = 'Cloudflare Save Test';\n    let color = '';\n\n    if (type === 'success') {\n      icon = '‚úÖ';\n      title = 'Test Successful';\n      color = 'green';\n    } else if (type === 'error') {\n      icon = '‚ùå';\n      title = 'Test Failed';\n      color = 'red';\n    } else if (type === 'info') {\n      icon = '‚ÑπÔ∏è';\n      title = 'Test Cancelled';\n      color = 'blue';\n    }\n\n    // Create formatted content using TiddlyWiki markup\n    const formattedText = `<div style=\"background-color: ${color === 'green' ? '#d4edda' : color === 'red' ? '#f8d7da' : '#d1ecf1'}; border: 1px solid ${color === 'green' ? '#c3e6cb' : color === 'red' ? '#f5c6cb' : '#bee5eb'}; border-radius: 4px; padding: 15px; margin: 10px 0;\">\n\n!! ${icon} ${title}\n\n${message.split('\\n').map(line => line.trim()).filter(line => line).join('\\n\\n')}\n\n</div>`;\n\n    $tw.wiki.addTiddler(new $tw.Tiddler({\n      title: tempTiddler,\n      text: formattedText,\n      type: 'text/vnd.tiddlywiki',\n      'modal-title': title\n    }));\n\n    $tw.modal.display(tempTiddler, {\n      downloadLink: null\n    });\n\n    // Don't auto-delete - let the user close the modal\n    // The modal will be recreated next time anyway\n  };\n\n  TestCloudflareAction.prototype.showNotification = function(tiddlerTitle) {\n    if (typeof $tw !== 'undefined' && $tw.notifier) {\n      $tw.notifier.display(tiddlerTitle);\n    }\n  };\n\n  exports['action-test-cloudflare'] = TestCloudflareAction;\n\n})();\n"
    },
    "$:/plugins/BenSweaterVest/cloudflare-saver/clear-password-action.js": {
      "title": "$:/plugins/BenSweaterVest/cloudflare-saver/clear-password-action.js",
      "type": "application/javascript",
      "module-type": "widget",
      "text": "/*\\\ntitle: $:/plugins/BenSweaterVest/cloudflare-saver/clear-password-action.js\ntype: application/javascript\nmodule-type: widget\n\nAction widget to clear the remembered session password\n\n\\*/\n(function(){\n\n  'use strict';\n\n  const Widget = require('$:/core/modules/widgets/widget.js').widget;\n\n  const ClearPasswordAction = function(parseTreeNode,options) {\n    this.initialise(parseTreeNode,options);\n  };\n\n  ClearPasswordAction.prototype = new Widget();\n\n  ClearPasswordAction.prototype.render = function(_parent,_nextSibling) {\n    this.computeAttributes();\n    this.execute();\n  };\n\n  ClearPasswordAction.prototype.execute = function() {\n    // Nothing to execute\n  };\n\n  ClearPasswordAction.prototype.refresh = function(_changedTiddlers) {\n    return false;\n  };\n\n  ClearPasswordAction.prototype.invokeAction = function(_triggeringWidget,_event) {\n    // Clear the session password by sending a message to the saver\n    $tw.rootWidget.dispatchEvent({\n      type: 'cloudflare-clear-password'\n    });\n\n    // Show notification\n    if ($tw.notifier) {\n      const tempTiddler = '$:/temp/cloudflare-password-cleared';\n      $tw.wiki.addTiddler(new $tw.Tiddler({\n        title: tempTiddler,\n        text: 'Session password cleared',\n        tags: '$:/tags/Alert'\n      }));\n\n      setTimeout(() => {\n        $tw.wiki.deleteTiddler(tempTiddler);\n      }, 3000);\n    }\n\n    return true;\n  };\n\n  exports['action-clear-cloudflare-password'] = ClearPasswordAction;\n\n})();\n"
    },
    "$:/plugins/BenSweaterVest/cloudflare-saver/settings": {
      "title": "$:/plugins/BenSweaterVest/cloudflare-saver/settings",
      "type": "text/vnd.tiddlywiki",
      "caption": "CloudFlare Saver",
      "tags": "$:/tags/ControlPanel/Saving",
      "text": "\\define config-base() $:/config/cloudflare-saver/\n\n!! ~CloudFlare Saver\n\n<$checkbox tiddler={{{ [<config-base>addsuffix[enabled]] }}} field=\"text\" checked=\"yes\" unchecked=\"no\" default=\"no\"> Enable saving to Cloudflare Functions</$checkbox>\n\n<div class=\"tc-control-panel-hint\">\nSave your TiddlyWiki to GitHub via Cloudflare Functions with password authentication. Works as an additional save option alongside your existing save methods.\n</div>\n\n<$reveal state={{{ [<config-base>addsuffix[enabled]] }}} type=\"match\" text=\"yes\" animate=\"yes\">\n\n!!! Connection Status\n\n<div style=\"padding: 10px; background-color: #f8f9fa; border-radius: 4px; margin: 10px 0;\">\n<$list filter=\"[[$:/config/cloudflare-saver/stats/last-save-status]get[text]match[success]]\">\n<span style=\"color: green;\">‚óè</span> ''Last Save:'' Successful at <$view tiddler=\"$:/config/cloudflare-saver/stats/last-save-status\" field=\"last-save-time\"/>\n</$list>\n<$list filter=\"[[$:/config/cloudflare-saver/stats/last-save-status]get[text]match[failure]]\">\n<span style=\"color: red;\">‚óè</span> ''Last Save:'' Failed at <$view tiddler=\"$:/config/cloudflare-saver/stats/last-save-status\" field=\"last-save-time\"/>\n<br>''Error:'' <$view tiddler=\"$:/config/cloudflare-saver/stats/last-save-status\" field=\"last-save-error\"/>\n</$list>\n<$list filter=\"[[$:/config/cloudflare-saver/stats/last-save-status]!has[text]]\">\n<span style=\"color: gray;\">‚óè</span> ''Status:'' No saves yet\n</$list>\n</div>\n\n!!! Save Statistics\n\n<div style=\"padding: 10px; background-color: #f8f9fa; border-radius: 4px; margin: 10px 0;\">\n''Successful Saves:'' <$text text={{{ [[$:/config/cloudflare-saver/stats/successful-saves]get[text]else[0]] }}}/>\n<br>\n''Failed Saves:'' <$text text={{{ [[$:/config/cloudflare-saver/stats/failed-saves]get[text]else[0]] }}}/>\n<br>\n<$button class=\"tc-btn-invisible tc-tiddlylink\">\nüîÑ Reset Statistics\n<$action-deletetiddler $tiddler=\"$:/config/cloudflare-saver/stats/successful-saves\"/>\n<$action-deletetiddler $tiddler=\"$:/config/cloudflare-saver/stats/failed-saves\"/>\n<$action-deletetiddler $tiddler=\"$:/config/cloudflare-saver/stats/last-save-status\"/>\n</$button>\n</div>\n\n!!! Cloudflare Function Endpoint URL\n\n<$edit-text tiddler={{{ [<config-base>addsuffix[endpoint]] }}} field=\"text\" default=\"\" placeholder=\"https://your-site.pages.dev/save\" tag=\"input\" type=\"url\" class=\"tc-edit-text\"/>\n\n<div class=\"tc-control-panel-hint\">\nThe full URL to your deployed Cloudflare Function endpoint (e.g., `https://my-wiki.pages.dev/save`)\n</div>\n\n!!! Advanced Options\n\n<$checkbox tiddler={{{ [<config-base>addsuffix[notifications]] }}} field=\"text\" checked=\"yes\" unchecked=\"no\" default=\"yes\"> Show save notifications</$checkbox>\n\n<$checkbox tiddler={{{ [<config-base>addsuffix[auto-retry]] }}} field=\"text\" checked=\"yes\" unchecked=\"no\" default=\"yes\"> Auto-retry failed saves (up to 3 attempts)</$checkbox>\n\n<$checkbox tiddler={{{ [<config-base>addsuffix[remember-password]] }}} field=\"text\" checked=\"yes\" unchecked=\"no\" default=\"no\"> Remember password during session</$checkbox>\n\n<$reveal state={{{ [<config-base>addsuffix[remember-password]] }}} type=\"match\" text=\"yes\">\n<div style=\"margin-left: 25px;\">\n<$button class=\"tc-btn-invisible tc-tiddlylink\">\nüîë Clear Remembered Password\n<$action-clear-cloudflare-password/>\n</$button>\n</div>\n</$reveal>\n\n<div class=\"tc-control-panel-hint\">\nPassword is stored in memory only and cleared on page reload. Only enable on trusted devices.\n</div>\n\n<$checkbox tiddler={{{ [<config-base>addsuffix[debug]] }}} field=\"text\" checked=\"yes\" unchecked=\"no\" default=\"no\"> Enable debug logging to console</$checkbox>\n\n!!! Request Timeout\n\n<$edit-text tiddler={{{ [<config-base>addsuffix[timeout]] }}} field=\"text\" default=\"30\" tag=\"input\" type=\"number\" min=\"5\" class=\"tc-edit-text\" size=\"10\"/> seconds\n\n<div class=\"tc-control-panel-hint\">\nHow long to wait for save requests before timing out (minimum 5 seconds)\n</div>\n\n!!! Quick Setup Wizard\n\n<$button class=\"tc-btn-big-green\">\nüöÄ Launch Setup Wizard\n<$action-navigate $to=\"$:/plugins/BenSweaterVest/cloudflare-saver/wizard\"/>\n</$button>\n\n<div class=\"tc-control-panel-hint\">\nStep-by-step guided setup for first-time users\n</div>\n\n!!! Setup Instructions\n\n<$button set=\"$:/state/cloudflare-saver/show-setup\" setTo=\"yes\" class=\"\">\n<$list filter=\"[[$:/state/cloudflare-saver/show-setup]get[text]match[yes]]\" emptyMessage=\"‚ñ∂ Click to expand setup guide\">\n‚ñº Click to hide setup guide\n</$list>\n</$button>\n\n<$reveal state=\"$:/state/cloudflare-saver/show-setup\" type=\"match\" text=\"yes\" animate=\"yes\">\n\n''1. Create Cloudflare Pages Site''\n\n# Go to [[Cloudflare Pages|https://pages.cloudflare.com/]]\n# Connect your GitHub account and create a Pages project from your TiddlyWiki repository\n# Deploy your site (e.g., `https://my-tiddlywiki.pages.dev`)\n\n''2. Create GitHub Personal Access Token''\n\n# Go to GitHub ‚Üí Settings ‚Üí Developer settings ‚Üí [[Personal access tokens|https://github.com/settings/tokens]]\n# Click \"Generate new token (classic)\"\n# Select scope: `repo` (Full control of private repositories)\n# Copy the token securely\n\n''3. Create Cloudflare Function''\n\nCreate a file at `functions/save.js` in your repository root. The complete, production-ready function code is available at:\n\nhttps://github.com/BenSweaterVest/tiddlywiki-cloudflare-saver/blob/main/demo/functions/save.js\n\nThe function includes password authentication, rate limiting, content validation, retry logic, and proper UTF-8 handling.\n\n''4. Set Environment Variables''\n\nIn Cloudflare Pages ‚Üí Settings ‚Üí Environment Variables ‚Üí Production:\n\n|!Variable |!Type |!Description |\n|`GITHUB_TOKEN` |Secret |GitHub Personal Access Token (with `repo` scope) |\n|`GITHUB_REPO` |Text |Repository in format `username/repo-name` |\n|`SAVE_PASSWORD` |Secret |Password for authenticating saves |\n|`FILE_PATH` |Text |Path to TiddlyWiki file (optional, default: `index.html`) |\n|`MAX_CONTENT_SIZE` |Text |Max file size in bytes (optional, default: 52428800 = 50MB) |\n|`ALLOWED_ORIGINS` |Text |Comma-separated origins for CORS (optional, default: `*`) |\n\nMark `GITHUB_TOKEN` and `SAVE_PASSWORD` as encrypted/secret variables.\n\n''5. Configure and Test''\n\n# Enter your Cloudflare Function URL above\n# Use the TiddlyWiki save button - you'll be prompted for your password\n# Check for success notification\n\n</$reveal>\n\n!!! Test Connection\n\n<$button class=\"tc-btn-big-green\">\n{{$:/core/images/save-button}} Test Cloudflare Save\n<$action-test-cloudflare/>\n</$button>\n\n<div class=\"tc-control-panel-hint\">\nThis will test your Cloudflare Function connection without triggering other savers. You'll be prompted for your password and will see a clear success or error message.\n</div>\n\n</$reveal>\n"
    },
    "$:/plugins/BenSweaterVest/cloudflare-saver/wizard": {
      "title": "$:/plugins/BenSweaterVest/cloudflare-saver/wizard",
      "type": "text/vnd.tiddlywiki",
      "caption": "Cloudflare Saver Setup Wizard",
      "tags": "",
      "text": "\\define wizard-state() $:/state/cloudflare-saver/wizard-step\n\n!! üöÄ Cloudflare Saver Setup Wizard\n\nWelcome! This wizard will guide you through setting up your Cloudflare Saver plugin step by step.\n\n<$reveal state=<<wizard-state>> type=\"nomatch\" text=\"1\" tag=\"div\">\n<$button set=<<wizard-state>> setTo=\"1\" class=\"tc-btn-big-green\">\nStart Setup Wizard\n</$button>\n</$reveal>\n\n<$reveal state=<<wizard-state>> type=\"match\" text=\"1\" tag=\"div\">\n\n!!! Step 1: Create GitHub Repository\n\nYou need a GitHub repository to store your TiddlyWiki file.\n\n''What to do:''\n\n# Go to https://github.com/new\n# Name your repository (e.g., `my-tiddlywiki`)\n# Choose Public or Private\n# Click \"Create repository\"\n# Upload your `index.html` TiddlyWiki file to the repository\n\n<$checkbox tiddler=\"$:/state/cloudflare-saver/wizard-step1-done\" field=\"text\" checked=\"yes\" unchecked=\"no\"> I've created my repository</$checkbox>\n\n<$reveal state=\"$:/state/cloudflare-saver/wizard-step1-done\" type=\"match\" text=\"yes\">\n<$button set=<<wizard-state>> setTo=\"2\" class=\"tc-btn-big-green\">\nNext Step ‚Üí\n</$button>\n</$reveal>\n\n</$reveal>\n\n<$reveal state=<<wizard-state>> type=\"match\" text=\"2\" tag=\"div\">\n\n!!! Step 2: Create Cloudflare Pages Site\n\nConnect your repository to Cloudflare Pages.\n\n''What to do:''\n\n# Go to https://pages.cloudflare.com/\n# Click \"Create a project\"\n# Connect your GitHub account\n# Select your TiddlyWiki repository\n# Use these settings:\n## Build command: (leave empty)\n## Build output directory: `/`\n# Click \"Save and Deploy\"\n# Wait for deployment to complete\n# Copy your site URL (e.g., `https://my-wiki.pages.dev`)\n\n''Your Cloudflare Pages URL:''\n<$edit-text tiddler=\"$:/state/cloudflare-saver/wizard-pages-url\" field=\"text\" tag=\"input\" type=\"url\" class=\"tc-edit-text\" placeholder=\"https://my-wiki.pages.dev\"/>\n\n<$reveal state=\"$:/state/cloudflare-saver/wizard-pages-url\" type=\"nomatch\" text=\"\">\n<$button set=<<wizard-state>> setTo=\"3\" class=\"tc-btn-big-green\">\nNext Step ‚Üí\n</$button>\n</$reveal>\n\n<$button set=<<wizard-state>> setTo=\"1\" class=\"tc-btn-invisible tc-tiddlylink\">\n‚Üê Previous\n</$button>\n\n</$reveal>\n\n<$reveal state=<<wizard-state>> type=\"match\" text=\"3\" tag=\"div\">\n\n!!! Step 3: Create GitHub Personal Access Token\n\nThis allows Cloudflare to save changes to your repository.\n\n''What to do:''\n\n# Go to https://github.com/settings/tokens\n# Click \"Generate new token\" ‚Üí \"Generate new token (classic)\"\n# Name it \"TiddlyWiki Cloudflare Saver\"\n# Set expiration (recommend: No expiration for personal wikis)\n# Check the `repo` scope (Full control of private repositories)\n# Click \"Generate token\"\n# '''IMPORTANT:''' Copy the token immediately (it won't be shown again!)\n\n<$checkbox tiddler=\"$:/state/cloudflare-saver/wizard-step3-done\" field=\"text\" checked=\"yes\" unchecked=\"no\"> I've generated and copied my token</$checkbox>\n\n<$reveal state=\"$:/state/cloudflare-saver/wizard-step3-done\" type=\"match\" text=\"yes\">\n<$button set=<<wizard-state>> setTo=\"4\" class=\"tc-btn-big-green\">\nNext Step ‚Üí\n</$button>\n</$reveal>\n\n<$button set=<<wizard-state>> setTo=\"2\" class=\"tc-btn-invisible tc-tiddlylink\">\n‚Üê Previous\n</$button>\n\n</$reveal>\n\n<$reveal state=<<wizard-state>> type=\"match\" text=\"4\" tag=\"div\">\n\n!!! Step 4: Create Cloudflare Function\n\nThis is the serverless function that handles saves.\n\n''What to do:''\n\n# In your repository on GitHub, create a new folder called `functions`\n# Inside `functions`, create a file called `save.js`\n# Copy the code from: https://github.com/BenSweaterVest/tiddlywiki-cloudflare-saver/blob/main/demo/functions/save.js\n# Commit the file\n\n<$checkbox tiddler=\"$:/state/cloudflare-saver/wizard-step4-done\" field=\"text\" checked=\"yes\" unchecked=\"no\"> I've created functions/save.js</$checkbox>\n\n<$reveal state=\"$:/state/cloudflare-saver/wizard-step4-done\" type=\"match\" text=\"yes\">\n<$button set=<<wizard-state>> setTo=\"5\" class=\"tc-btn-big-green\">\nNext Step ‚Üí\n</$button>\n</$reveal>\n\n<$button set=<<wizard-state>> setTo=\"3\" class=\"tc-btn-invisible tc-tiddlylink\">\n‚Üê Previous\n</$button>\n\n</$reveal>\n\n<$reveal state=<<wizard-state>> type=\"match\" text=\"5\" tag=\"div\">\n\n!!! Step 5: Configure Environment Variables\n\nSet up the secrets and configuration in Cloudflare.\n\n''What to do:''\n\n# Go to your Cloudflare Pages dashboard\n# Select your project\n# Go to Settings ‚Üí Environment Variables\n# Click \"Add variable\" for Production\n# Add these variables:\n\n|!Variable |!Value |!Encrypt? |\n|`GITHUB_TOKEN` |Your GitHub token from Step 3 |‚úì Yes |\n|`GITHUB_REPO` |`your-username/your-repo-name` |No |\n|`SAVE_PASSWORD` |Choose a password for saves |‚úì Yes |\n\n# Click \"Save\"\n# Wait for the automatic redeploy\n\n<$checkbox tiddler=\"$:/state/cloudflare-saver/wizard-step5-done\" field=\"text\" checked=\"yes\" unchecked=\"no\"> I've set up all environment variables</$checkbox>\n\n<$reveal state=\"$:/state/cloudflare-saver/wizard-step5-done\" type=\"match\" text=\"yes\">\n<$button set=<<wizard-state>> setTo=\"6\" class=\"tc-btn-big-green\">\nNext Step ‚Üí\n</$button>\n</$reveal>\n\n<$button set=<<wizard-state>> setTo=\"4\" class=\"tc-btn-invisible tc-tiddlylink\">\n‚Üê Previous\n</$button>\n\n</$reveal>\n\n<$reveal state=<<wizard-state>> type=\"match\" text=\"6\" tag=\"div\">\n\n!!! Step 6: Configure Plugin\n\nAlmost done! Now configure the plugin in TiddlyWiki.\n\n''Your endpoint URL is:''\n\n<div style=\"background-color: #f8f9fa; padding: 10px; border-radius: 4px; margin: 10px 0; font-family: monospace;\">\n<$text text={{{ [[$:/state/cloudflare-saver/wizard-pages-url]get[text]addsuffix[/save]] }}}/>\n</div>\n\n<$button class=\"tc-btn-big-green\">\nAuto-Configure Plugin\n<$action-setfield $tiddler=\"$:/config/cloudflare-saver/enabled\" text=\"yes\"/>\n<$action-setfield $tiddler=\"$:/config/cloudflare-saver/endpoint\" text={{{ [[$:/state/cloudflare-saver/wizard-pages-url]get[text]addsuffix[/save]] }}}/>\n<$action-setfield $tiddler=\"$:/config/cloudflare-saver/notifications\" text=\"yes\"/>\n<$action-setfield $tiddler=\"$:/config/cloudflare-saver/auto-retry\" text=\"yes\"/>\n<$action-navigate $to=\"$:/ControlPanel\" $scroll=\"yes\"/>\n</$button>\n\n<div class=\"tc-control-panel-hint\">\nThis will enable the plugin and set your endpoint URL automatically.\n</div>\n\n<$button set=<<wizard-state>> setTo=\"5\" class=\"tc-btn-invisible tc-tiddlylink\">\n‚Üê Previous\n</$button>\n\n</$reveal>\n\n<hr>\n\n<$button class=\"tc-btn-invisible tc-tiddlylink\">\nüè† Return to Settings\n<$action-navigate $to=\"$:/ControlPanel\"/>\n<$action-deletetiddler $tiddler=<<wizard-state>>/>\n<$action-deletetiddler $tiddler=\"$:/state/cloudflare-saver/wizard-step1-done\"/>\n<$action-deletetiddler $tiddler=\"$:/state/cloudflare-saver/wizard-step3-done\"/>\n<$action-deletetiddler $tiddler=\"$:/state/cloudflare-saver/wizard-step4-done\"/>\n<$action-deletetiddler $tiddler=\"$:/state/cloudflare-saver/wizard-step5-done\"/>\n<$action-deletetiddler $tiddler=\"$:/state/cloudflare-saver/wizard-pages-url\"/>\n</$button>\n"
    },
    "$:/plugins/BenSweaterVest/cloudflare-saver/readme": {
      "title": "$:/plugins/BenSweaterVest/cloudflare-saver/readme",
      "type": "text/vnd.tiddlywiki",
      "text": "!! Overview\n\nThis plugin enables saving your TiddlyWiki directly to a GitHub repository via Cloudflare Functions with secure password authentication, working as an additional save option alongside your existing save methods.\n\n!! Key Features\n\n* **Secure**: Password-protected saves with environment variable storage\n* **Fast**: Serverless architecture via Cloudflare Functions\n* **Reliable**: Built-in retry logic and comprehensive error handling\n* **Responsive**: Visual notifications for save status\n* **Configurable**: Comprehensive settings panel with debug mode\n* **Compatible**: Works alongside existing TiddlyWiki save methods\n\n!! Quick Setup\n\n# Go to Control Panel ‚Üí Saving tab\n# Find the CloudFlare Saver section\n# Enable saving to Cloudflare Functions\n# Follow the setup guide to configure your Cloudflare Function endpoint\n# Test the connection using the built-in test button\n\n!! How It Works\n\nThis plugin adds Cloudflare saving as an additional option to your existing save methods. When enabled, you can save your TiddlyWiki through a Cloudflare Function that securely commits changes to your GitHub repository.\n\n!! Support\n\nFor detailed setup instructions, troubleshooting, and support:\nhttps://github.com/BenSweaterVest/tiddlywiki-cloudflare-saver\n\n!! Version\n\nVersion 1.0.0 - Initial release with full functionality and comprehensive documentation.\n\n"
    },
    "$:/plugins/BenSweaterVest/cloudflare-saver/notifications/failure": {
      "title": "$:/plugins/BenSweaterVest/cloudflare-saver/notifications/failure",
      "type": "text/vnd.tiddlywiki",
      "text": "<div class=\"tc-notification-banner tc-notification-banner-error\">\n<$button class=\"tc-btn-invisible tc-notification-btn\" message=\"tm-close-tiddler\">{{$:/core/images/close-button}}</$button>\n{{$:/core/images/warning}} Save failed. Check console for details.\n</div>\n"
    },
    "$:/plugins/BenSweaterVest/cloudflare-saver/notifications/saving": {
      "title": "$:/plugins/BenSweaterVest/cloudflare-saver/notifications/saving",
      "type": "text/vnd.tiddlywiki",
      "text": "<div class=\"tc-notification-banner\">\n<$button class=\"tc-btn-invisible tc-notification-btn\" message=\"tm-close-tiddler\">{{$:/core/images/close-button}}</$button>\n<span class=\"tc-notification-loading\">{{$:/core/images/spiral}}</span> Saving to GitHub via Cloudflare...\n</div>\n"
    },
    "$:/plugins/BenSweaterVest/cloudflare-saver/notifications/success": {
      "title": "$:/plugins/BenSweaterVest/cloudflare-saver/notifications/success",
      "type": "text/vnd.tiddlywiki",
      "<$button class=\"tc-btn-invisible tc-notification-btn\" message=\"tm-close-tiddler\">{{$": "/core/images/close-button}}</$button>",
      "{{$": "/core/images/done-button}} Successfully saved to GitHub!",
      "text": ""
    }
  }
}